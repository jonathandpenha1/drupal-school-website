/* @license GNU-GPL-2.0-or-later https://www.drupal.org/licensing/faq */
(function($,Drupal,once){'use strict';Drupal.webform=Drupal.webform||{};Drupal.webform.imageSelect=Drupal.webform.imageSelect||{};Drupal.webform.imageSelect.options=Drupal.webform.imageSelect.options||{};Drupal.behaviors.webformImageSelect={attach:function(context){if(!$.fn.imagepicker)return;$(once('webform-image-select','.js-webform-image-select',context)).each(function(){var $select=$(this);var isMultiple=$select.attr('multiple');var images=JSON.parse($select.attr('data-images'));for(var value in images)if(images.hasOwnProperty(value)){var image=images[value];value=value.toString().replace(/"/g,'\\"');$select.find('option[value="'+value+'"]').attr({'data-img-src':image.src,'data-img-label':image.text,'data-img-alt':image.text});}var options=$.extend({hide_select:false},Drupal.webform.imageSelect.options);if($select.attr('data-show-label'))options.show_label=true;$select.imagepicker(options);$select.attr('tabindex','-1');if(isMultiple)$select.next('.image_picker_selector').attr('role','radiogroup');var $thumbnail=$select.next('.image_picker_selector').find('.thumbnail');$thumbnail.prop('tabindex','0').attr('role',isMultiple?'checkbox':'radio').each(function(){var alt=$(this).find('img').attr('alt');if(alt){alt=alt.replace(/<\/?[^>]+(>|$)/g,'');$(this).find('img').attr('alt',alt);$(this).attr('title',alt);}$(this).find('p').attr('aria-hidden',true);}).on('focus',function(event){$(this).addClass('focused');}).on('blur',function(event){$(this).removeClass('focused');}).on('keydown',function(event){if(event.which===32){$(this).trigger('click');event.preventDefault();}else if(event.which===37||event.which===38){var $prev=$(this).parent();do $prev=$prev.prev();while($prev.length&&$prev.is(':hidden'));$prev.find('.thumbnail').trigger('focus');event.preventDefault();}else{if(event.which===39||event.which===40){var $next=$(this).parent();do $next=$next.next();while($next.length&&$next.is(':hidden'));$next.find('.thumbnail').trigger('focus');event.preventDefault();}}}).on('click',function(event){var selected=$(this).hasClass('selected');$(this).attr('aria-checked',selected);});});}};})(jQuery,Drupal,once);;
